<!-- templates/sprint_detail.html -->
{% extends 'base.html' %}
{% block content %}
<section class="section sprint-detail-section">
  <div class="section-header">
    <h1>{{ sprint.name }}</h1>
  </div>
  <div class="detail-wrap">
    <!-- FILTER PANEL -->
    <aside class="filter-panel">
      <h4>Filter by Type</h4>
      <div class="filter-group types">
        {% for t in filter_types %}
          <label>
            <input type="checkbox" class="filter-type" value="{{ t.id }}" />
            {{ t.name }}
          </label>
        {% endfor %}
      </div>
      <h4>Filter by Group</h4>
      <div class="filter-group groups">
        {% for g in filter_groups %}
          <label>
            <input type="checkbox" class="filter-group" value="{{ g.id }}" />
            {{ g.name }}
          </label>
        {% endfor %}
      </div>
    </aside>

    <!-- AVAILABLE RESOURCES -->
    <section class="resource-panel">
      <h3>Available Resources</h3>
      <ul id="resource-pool">
        {% if avail_resources %}
          {% for r, avail in avail_resources %}
            <li
              class="draggable-resource"
              draggable="true"
              data-id="{{ r.id }}"
              data-capacity="{{ avail }}"
              data-type-id="{{ r.type.id if r.type }}"
              data-group-id="{{ r.group.id if r.group }}"
            >
              <strong>{{ r.name }}</strong>
              {% if r.type or r.group %}
                <div class="resource-meta">
                  {% if r.type %}<span class="meta-type">{{ r.type.name }}</span>{% endif %}
                  {% if r.group %}<span class="meta-group">{{ r.group.name }}</span>{% endif %}
                </div>
              {% endif %}
              <div class="capacity-label">{{ avail }}%</div>
            </li>
          {% endfor %}
        {% else %}
          <li><em>None left to assign.</em></li>
        {% endif %}
      </ul>
    </section>

    <!-- PROJECTS STRIP -->
    <section class="projects-container">
      {% for proj in sprint.projects %}
        <div
          class="card project-card project-dropzone"
          data-project-id="{{ proj.id }}"
        >
          <h4>
            {{ proj.name }}
            <form
              method="post"
              action="{{ url_for('edit_project', sprint_id=sprint.id, project_id=proj.id) }}"
              class="inline-form"
            >
              <input name="name" value="{{ proj.name }}" required class="input input-small" />
              <button title="Rename" class="btn btn-secondary">
                <span class="material-icons">edit</span>
              </button>
            </form>
            <form
              method="post"
              action="{{ url_for('delete_project', sprint_id=sprint.id, project_id=proj.id) }}"
              class="inline-form"
            >
              <button title="Delete" class="btn btn-secondary">
                <span class="material-icons">delete</span>
              </button>
            </form>
          </h4>

          <ul>
            {% if proj.assignments %}
              {% for a in proj.assignments %}
                <li>
                  <strong>{{ a.resource.name }}</strong>
                  {% if a.resource.type or a.resource.group %}
                    <div class="resource-meta">
                      {% if a.resource.type %}<span class="meta-type">{{ a.resource.type.name }}</span>{% endif %}
                      {% if a.resource.group %}<span class="meta-group">{{ a.resource.group.name }}</span>{% endif %}
                    </div>
                  {% endif %}
                  ({{ a.capacity }}%)
                  <button
                    class="btn btn-secondary unassign-btn"
                    data-resource-id="{{ a.resource.id }}"
                  >
                    <span class="material-icons">close</span>
                  </button>
                </li>
              {% endfor %}
            {% else %}
              <li><em>No resources assigned.</em></li>
            {% endif %}
          </ul>
        </div>
      {% endfor %}
    </section>
  </div>
</section>
<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}
