{% extends 'base.html' %}
{% block content %}
<section class="section">
  <div class="section-header">
    <h1>Resources</h1>
    <form class="inline-form"
          method="post"
          action="{{ url_for('add_resource') }}">
      <input type="text"
             name="name"
             placeholder="New resource name"
             required
             class="input" />
      <select name="type_id" class="input">
        <option value="">No Type</option>
        {% for t in types %}
          <option value="{{ t.id }}">{{ t.name }}</option>
        {% endfor %}
      </select>
      <select name="group_id" class="input">
        <option value="">No Group</option>
        {% for g in groups %}
          <option value="{{ g.id }}">{{ g.name }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-primary">
        <span class="material-icons">add</span> Add Resource
      </button>
    </form>
  </div>

  <div class="cards-container">
    {% for r in resources %}
      <div class="resource-wrapper" data-resource-id="{{ r.id }}">
        <!-- Static card -->
        <div class="card resource-card">
          <!-- edit‐toggle icon -->
          <button class="edit-toggle btn-icon"
                  data-resource-id="{{ r.id }}"
                  aria-label="Edit {{ r.name }}">
            <span class="material-icons">edit</span>
          </button>

          <h2>{{ r.name }}</h2>
          {% if r.type or r.group %}
            <div class="resource-meta">
              {% if r.type %}<span class="meta-type">{{ r.type.name }}</span>{% endif %}
              {% if r.group %}<span class="meta-group">{{ r.group.name }}</span>{% endif %}
            </div>
          {% endif %}
        </div>

        <!-- Hidden edit panel -->
        <div class="edit-panel" id="edit-panel-{{ r.id }}" hidden>
          <form method="post"
                action="{{ url_for('edit_resource', resource_id=r.id) }}"
                class="inline-form edit-form">
            <input name="name"
                   value="{{ r.name }}"
                   required
                   class="input input-small" />
            <select name="type_id" class="input input-small">
              <option value="">No Type</option>
              {% for t in types %}
                <option value="{{ t.id }}"
                        {% if r.type_id == t.id %}selected{% endif %}>
                  {{ t.name }}
                </option>
              {% endfor %}
            </select>
            <select name="group_id" class="input input-small">
              <option value="">No Group</option>
              {% for g in groups %}
                <option value="{{ g.id }}"
                        {% if r.group_id == g.id %}selected{% endif %}>
                  {{ g.name }}
                </option>
              {% endfor %}
            </select>
            <button type="submit" title="Save" class="btn btn-secondary">
              <span class="material-icons">check</span>
            </button>
            <button type="button" class="btn btn-secondary cancel-edit"
                    data-resource-id="{{ r.id }}">
              <span class="material-icons">close</span>
            </button>
          </form>
          <form method="post"
                action="{{ url_for('delete_resource', resource_id=r.id) }}"
                class="inline-form delete-form">
            <button title="Delete" class="btn btn-secondary">
              <span class="material-icons">delete</span>
            </button>
          </form>
        </div>
      </div>
    {% else %}
      <p>No resources defined yet.</p>
    {% endfor %}
  </div>
</section>
<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}
